<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How YOU can create a Serverless API in C# and .NET</title>
    <meta name="description" content="[object Object]">
    
    
    <link rel="preload" href="/assets/css/0.styles.b244743b.css" as="style"><link rel="preload" href="/assets/js/app.7aecc4ed.js" as="script"><link rel="preload" href="/assets/js/7.1b275639.js" as="script"><link rel="preload" href="/assets/js/6.6ae5d1ce.js" as="script"><link rel="preload" href="/assets/js/36.589ace7f.js" as="script"><link rel="prefetch" href="/assets/js/1.1b576644.js"><link rel="prefetch" href="/assets/js/10.28dc659c.js"><link rel="prefetch" href="/assets/js/11.01a6b72e.js"><link rel="prefetch" href="/assets/js/12.53802374.js"><link rel="prefetch" href="/assets/js/13.f99754e6.js"><link rel="prefetch" href="/assets/js/14.be2287f7.js"><link rel="prefetch" href="/assets/js/15.4812c23c.js"><link rel="prefetch" href="/assets/js/16.e0d53503.js"><link rel="prefetch" href="/assets/js/17.2712ee25.js"><link rel="prefetch" href="/assets/js/18.4bb275da.js"><link rel="prefetch" href="/assets/js/19.f5621388.js"><link rel="prefetch" href="/assets/js/20.1c3153be.js"><link rel="prefetch" href="/assets/js/21.e0b2aeea.js"><link rel="prefetch" href="/assets/js/22.fc2df48a.js"><link rel="prefetch" href="/assets/js/23.721d54f0.js"><link rel="prefetch" href="/assets/js/24.16d66ff8.js"><link rel="prefetch" href="/assets/js/25.6791de7d.js"><link rel="prefetch" href="/assets/js/26.ce321ad3.js"><link rel="prefetch" href="/assets/js/27.4fd4bd46.js"><link rel="prefetch" href="/assets/js/28.a4dc8303.js"><link rel="prefetch" href="/assets/js/29.dc03113d.js"><link rel="prefetch" href="/assets/js/3.262e56e6.js"><link rel="prefetch" href="/assets/js/30.06aeb9b3.js"><link rel="prefetch" href="/assets/js/31.9eab5d3b.js"><link rel="prefetch" href="/assets/js/32.6eba583a.js"><link rel="prefetch" href="/assets/js/33.d3c321e7.js"><link rel="prefetch" href="/assets/js/34.abcaac04.js"><link rel="prefetch" href="/assets/js/35.b60b2160.js"><link rel="prefetch" href="/assets/js/37.97fa555c.js"><link rel="prefetch" href="/assets/js/38.bc82e56e.js"><link rel="prefetch" href="/assets/js/39.6acb6c35.js"><link rel="prefetch" href="/assets/js/4.2aeaee3b.js"><link rel="prefetch" href="/assets/js/40.081d65d0.js"><link rel="prefetch" href="/assets/js/41.95492e98.js"><link rel="prefetch" href="/assets/js/42.352e531e.js"><link rel="prefetch" href="/assets/js/43.e3cadfae.js"><link rel="prefetch" href="/assets/js/44.5c195a84.js"><link rel="prefetch" href="/assets/js/45.88fd8515.js"><link rel="prefetch" href="/assets/js/46.8810b27f.js"><link rel="prefetch" href="/assets/js/47.25370980.js"><link rel="prefetch" href="/assets/js/48.d27b1ea8.js"><link rel="prefetch" href="/assets/js/49.e13fe247.js"><link rel="prefetch" href="/assets/js/5.9ce83512.js"><link rel="prefetch" href="/assets/js/50.35192888.js"><link rel="prefetch" href="/assets/js/51.878b2ea3.js"><link rel="prefetch" href="/assets/js/52.b6c43696.js"><link rel="prefetch" href="/assets/js/53.1e4750d7.js"><link rel="prefetch" href="/assets/js/54.9b1962a7.js"><link rel="prefetch" href="/assets/js/55.39b40066.js"><link rel="prefetch" href="/assets/js/56.f4e6d66f.js"><link rel="prefetch" href="/assets/js/57.9ecad878.js"><link rel="prefetch" href="/assets/js/58.cb4dd783.js"><link rel="prefetch" href="/assets/js/59.7bd56c58.js"><link rel="prefetch" href="/assets/js/60.11b64757.js"><link rel="prefetch" href="/assets/js/61.440d178f.js"><link rel="prefetch" href="/assets/js/62.ea91080d.js"><link rel="prefetch" href="/assets/js/63.8892642d.js"><link rel="prefetch" href="/assets/js/64.2c3a2adb.js"><link rel="prefetch" href="/assets/js/65.147f1e50.js"><link rel="prefetch" href="/assets/js/66.42ebdaec.js"><link rel="prefetch" href="/assets/js/67.21d37f4b.js"><link rel="prefetch" href="/assets/js/68.7e261eed.js"><link rel="prefetch" href="/assets/js/8.a354cea0.js"><link rel="prefetch" href="/assets/js/9.be23d1a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b244743b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>How YOU can create a Serverless API in C# and .NET</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dotnet-serverless.html#resources" class="sidebar-link">Resources</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-serverless.html#building-our-first-function" class="sidebar-link">Building our first function</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-serverless.html#set-up" class="sidebar-link">Set up</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-serverless.html#let-s-code" class="sidebar-link">Let's code</a></li></ul></li><li><a href="/pages/dotnet-serverless.html#build-a-rest-api" class="sidebar-link">Build a REST API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-serverless.html#creating-the-database" class="sidebar-link">Creating the database</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-serverless.html#list-of-products" class="sidebar-link">List of Products</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-serverless.html#get-a-specific-product" class="sidebar-link">Get a specific Product</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-serverless.html#create-a-product" class="sidebar-link">Create a Product</a></li></ul></li><li><a href="/pages/dotnet-serverless.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-you-can-create-a-serverless-api-in-c-and-net"><a href="#how-you-can-create-a-serverless-api-in-c-and-net" aria-hidden="true" class="header-anchor">#</a> How YOU can create a Serverless API in C# and .NET</h1> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/v7kxokqqguuaz5bb600p.jpg" alt=""></p> <blockquote><p>In this article we will go through building a Serverless function using C# and .NET. We will explain the WHY of Serverless but also learn to build, run and debug our first functions in VS Code.</p></blockquote> <p>If you are interested in how to author functions in JavaScript, have a look below, otherwise, please read on.</p> <p>Have a look at this series if you are curious about JavaScript and Serverless</p> <blockquote><p><a href="https://dev.to/azure/serverless-series-16o8" target="_blank" rel="noopener noreferrer">https://dev.to/azure/serverless-series-16o8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>Before we go into building our first functions let's mention what we will cover in this article:</p> <ul><li><strong>Why Serverless</strong>, Asking yourself why you do what you do is critical. There are some criteria that make using a Serverless function a good choice.</li> <li><strong>Core concepts</strong>, Serverless consists of a set of concepts that you need to know to work with it efficiently and generally understand what's going on. The most important concepts you need to know about is called input/output bindings.</li> <li><strong>Building our first functions</strong>, here we will cover how to author our functions by setting up triggers, parse input either from route/query parameters or a posted Body. We will also look at how we can define our output.</li></ul> <h2 id="resources"><a href="#resources" aria-hidden="true" class="header-anchor">#</a> Resources</h2> <ul><li><p><a href="https://azure.microsoft.com/en-us/free/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Sign up for a free Azure account<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
To create Serverless Azure Functions you will need a free Azure account</p></li> <li><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-function-vs-code?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Create your first Azure Function in VSCode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
A great first blog post that will show you function creation as well as deploy</p></li> <li><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-dotnet-class-library?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Using C# for Azure Functions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
A C# reference for Azure Functions</p></li> <li><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local#v2?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Install Azure Functions Core Tools<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
You will need Azure Functions Core Tools to be able to RUN and DEBUG Azure Functions from VS Code</p></li> <li><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Azure Functions docs overview<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
You can also create Azure Functions using Azure CLI and the Portal and more</p></li> <li><p><a href="https://docs.microsoft.com/en-us/cli/azure/?view=azure-cli-latest&amp;wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Azure CLI Install<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
The Azure CLI is an amazing way to manage your Cloud resources from the terminal, usually much quicker than using the Portal.</p></li> <li><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
A complete listing of all the trigger, input, and output bindings</p></li></ul> <p>##Â Why Serverless
Serverless is a <em>cloud-computing execution model</em>.</p> <blockquote><p>Ok, that sounds like a handful. What do we mean?</p></blockquote> <p>Simple, the function we write will be executed in the Cloud. This means we don't have to care about allocating a virtual machine or even run for example a web server to make the code run, that's managed for us. It also means that resource allocation is managed for us.</p> <blockquote><p>Sounds good, what else?</p></blockquote> <p>One of the primary reasons for choosing Serverless is the cost or lack thereof. Serverless is cheap. You normally only pay for when your function actually runs.</p> <blockquote><p>How come it's cheap?</p></blockquote> <p>Your function/s isn't actually there all the time, instances of them will get spun up as you need them. This means you might experience something called a <em>cold start</em>. This means it might take some time the first time an instance is spun up and you can start interacting with it.</p> <blockquote><p>I'm not sure that sounds that good, what if I want my customers to reach my function 24-7 or at least have it avoid this <em>cold start</em>, what then?</p></blockquote> <p>If you really want to avoid <em>cold starts</em> there is a premium plan</p> <blockquote><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-premium-plan?chrisnoring-blog-chnoring" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/azure-functions/functions-premium-plan<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>but before you go for that let's talk about what code to actually run there.</p> <blockquote><p>Ok?</p></blockquote> <p>Yea all kinds of code and business logic shouldn't run there. Only things that you do seldom should run as Serverless, like a utility function or some kind of computation.</p> <blockquote><p>Ok I get, I guess I have some code in my codebase that I could turn into Serverless, that don't need to run so often. I will save money doing this right?</p></blockquote> <p>Yes exactly, seldom run code can be made Serverless and thereby you will save a ton of money.</p> <blockquote><p>Is that all?</p></blockquote> <p>Well, there is more, serverless is usually part of a bigger picture in that it can interact with most of the cloud resources. It can be triggered by everything from Databases, to Queues to HTTP and we can also easily pass the computation result to another service in the Cloud</p> <blockquote><p>Wow, that sounds... really great.</p></blockquote> <p>##Â Core concepts
Ok so we mentioned part of the core concepts a bit already but let's make it more clear what those were.</p> <p>We got the following concepts:</p> <ul><li><strong>Trigger</strong>, this is what triggers our function to start. This could be an HTTP call, a raised event or a row entered in a database and much more</li> <li><strong>Input binding</strong>, an input binding is a connection to a resource, could be things like SignalR, Table Storage, CosmosDB and so on. The point is we don't have to instantiate a connection, it's pre-created and ready for us to interact with it</li> <li><strong>Output binding</strong>, this is simply what you can write to. You would, for example, use an input binding to have a connection to a database and read out a list of product. You would conversely use an ouput binding to create a new product entry given input data to the function</li></ul> <p>This might all sound a bit exotic bit it will be clearer as we learn to create some functions.</p> <p>I recommend have a look a this link</p> <blockquote><p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings?chrisnoring-blog-chnoring" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>to see the full scope of all supported input/output bindings</p> <h2 id="building-our-first-function"><a href="#building-our-first-function" aria-hidden="true" class="header-anchor">#</a> Building our first function</h2> <p>Ok, we have come to the exiting part, coding some functions. Before we start we will need to install some extensions to make our authoring experience a bit better.</p> <h3 id="set-up"><a href="#set-up" aria-hidden="true" class="header-anchor">#</a> Set up</h3> <p>We will need the following:</p> <ul><li><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local#v2?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Azure Functions Core Tools<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Azure Functions Extension for VS Code, search for <code>Azure Functions</code>. It should look like this:</li></ul> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/oi2oldbp394akv3rbhro.png" alt=""></p> <ul><li>Because we will work with C# we're gonna need the extension for it, it should look like so</li></ul> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/ru0ndx0fdfxid143vp5p.png" alt=""></p> <h3 id="let-s-code"><a href="#let-s-code" aria-hidden="true" class="header-anchor">#</a> Let's code</h3> <p>We are ready to code. We will do the following:</p> <ol><li>Generate an Azure Function App</li> <li>Create an Azure Function triggered by HTTP</li></ol> <p><strong>Generate an Azure Function App</strong>
Our functions will need to be hosted inside of an application. An application can have several functions in it though. This is quite straight forward, simply bring up the Command Palette in VS Code by select <code>View/Command Palette</code> or hit the key combination <code>COMMAND + SHIFT + P</code> if you are on a Mac. Once you have the menu up type: <code>Azure Functions: Create new project</code>.</p> <p>This will ask you for:</p> <ul><li><strong>Directory</strong>, what directory to store your app in, select your current directory</li> <li><strong>Code language</strong>, it will continue to ask you for code language, select C#</li> <li><strong>Trigger</strong>, Then it will ask you for your first functions trigger, select HTTP Trigger</li> <li><strong>Function Name</strong>, After that it will ask for the function name, type <code>Hello</code></li> <li><strong>Namespace</strong>, Then you will be asked for a namespace, For now, go with <code>Company.Function</code>, you can always change it later</li> <li><strong>Access Rights</strong>, When asked about Access Rights, select <code>Anonymous</code>. Security is a big thing but for this exercise we will focus on understanding parts, we can beef up the security later.</li></ul> <p>It will also ask you for the name of your first function, its language and type of trigger.</p> <p>This will generate a project for you. However, starting out it will complain all in red letters that there are unresolved dependencies. You can fix this either by clicking <code>restore</code> in the popup that shows up right after the project is done generating or you could enter the following command in the terminal, at the project root:</p> <blockquote><p>dotnet restore</p></blockquote> <p>This will restore dependencies that was pointed out in the project and you will soon see how the code looks happy again.</p> <p><strong>The anatomy of a function</strong></p> <p>Lets have a look at the file <code>Hello.cs</code> that was generated when we created our app:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Hello.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging<span class="token punctuation">;</span>
<span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Company<span class="token punctuation">.</span>Function
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token class-name">FunctionName</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>IActionResult<span class="token operator">&gt;</span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token class-name">HttpTrigger</span><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Anonymous<span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token class-name">HttpRequest</span> req<span class="token punctuation">,</span>
            <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;C# HTTP trigger function processed a request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">string</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>Query<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">string</span> requestBody <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">dynamic</span> data <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">DeserializeObject</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name <span class="token operator">??</span> data<span class="token punctuation">?.</span>name<span class="token punctuation">;</span>

            <span class="token keyword">return</span> name <span class="token operator">!=</span> <span class="token keyword">null</span>
                <span class="token punctuation">?</span> <span class="token punctuation">(</span>ActionResult<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">OkObjectResult</span><span class="token punctuation">(</span>$<span class="token string">&quot;Hello, {name}&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">BadRequestObjectResult</span><span class="token punctuation">(</span><span class="token string">&quot;Please pass a name on the query string or in the request body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>Most of the things we need to know about Azure Functions in C# is in that piece of code. Let's go through it, from the top:</p> <ul><li><strong>FunctionName</strong>, this is a decorator that takes a string argument. This is what the function will be called when we debug or in some other way try to test out our app. The string argument is <code>Hello</code> so we can expect the final URL for this function to be <code>[someUrl]/Hello</code>.</li> <li><strong>Run</strong>, this is an arbitrary function name, it could be called anything</li> <li><strong>HttpTrigger</strong>, this is a decorator decorating our HttpRequest parameter <code>req</code>. We start off in the decorator, setting the <code>AuthorizationLevel</code> to <code>Anonymous</code>, this means that anyone from the outside can access the function. There are other options on <code>AuthorizationLevel</code> that we will explore in future articles</li> <li><strong>HTTP Verbs list</strong>, Next is a parameter string list consisting of HTTP verbs. We can see we have the values <code>get</code> and <code>post</code> so far, which means the function will respond to those HTTP verbs. We can definitely extend the list to say <code>&quot;get&quot;, &quot;post&quot;, &quot;put&quot;, &quot;delete&quot;</code> but in REST you tend to only support one verb per type of action.</li> <li><strong>Route pattern</strong>, Next value is <code>Route</code>. If we change this we can start supporting route parameters, we will show this later.</li></ul> <p>That's it for the HttpRequest parameter. Let's look at <code>log</code> of type <code>ILogger</code>. By invoking this one we are able to write to the logs. The logs will be visible locally when you debug but also in the portal, once you have deployed your app.</p> <p>Ok then, let's look at the generated function body:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">string</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>Query<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">string</span> requestBody <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">dynamic</span> data <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">DeserializeObject</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
name <span class="token operator">=</span> name <span class="token operator">??</span> data<span class="token punctuation">?.</span>name<span class="token punctuation">;</span>

<span class="token keyword">return</span> name <span class="token operator">!=</span> <span class="token keyword">null</span>
    <span class="token punctuation">?</span> <span class="token punctuation">(</span>ActionResult<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">OkObjectResult</span><span class="token punctuation">(</span>$<span class="token string">&quot;Hello, {name}&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">BadRequestObjectResult</span><span class="token punctuation">(</span><span class="token string">&quot;Please pass a name on the query string or in the request body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The first line tells us how to parse out query parameters. We use the <code>Query</code> with a string argument to do so. So for example, if your URL looked like this <code>url/Hello?name='some value'</code> the variable <code>name</code> would hold the value <code>some value</code>.</p> <p>Next, we read out the Body using a StreamReader, note the use of the keyword <code>await</code>. Note, how this is matched at the beginning of the function head with an <code>async</code> keyword. Next line after that is to call <code>JsonConvert.DeserializeObject</code> and assign it to a <code>dynamic</code>. On the next line, we try to read out <code>name</code> from our Body, providing the Body was non-null. Finally we return a <code>200</code> response with <code>OkObjectResult</code> or a <code>401</code> using <code>BadRequestObjectResult</code>.</p> <p><strong>Run the function</strong></p> <p>Next up we will run the function using VS Code debugging and try out both the GET and the POST. Go to the menu and choose <code>Debug /Start Debugging</code> This should compile your app and start the runtime. You should see the following when it's done:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/85yrehv53fp2irk3g3mb.png" alt=""></p> <p>Go to your browser and enter the indicated URL <code>http://localhost:7071/api/hello</code>:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/2yo4hwka9bp64n8m8un0.png" alt=""></p> <p>The code is clearly unhappy with us, as we are not providing a query parameter or posting a body. Let's try it with a query param <code>?name=chris</code> so we type <code>http://localhost:7071/api/hello?name=chris</code> and it now says:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/kcyk92hwami7gp2p1c7l.png" alt=""></p> <p>All good!</p> <p>Let's put a breakpoint and then reload the browser:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/osvn88l598fn70djv00c.png" alt=""></p> <p>As you can see above the breakpoint is hit and we are able to inspect and debug our code like we are used to, good stuff ðŸ˜ƒ</p> <p>We clearly get the GET call to work, so what about POST? Bring up your favorite client for doing REST calls, whether that's cURL or Advanced Rest Client, that's up to you. Then create a request like so:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/ghap020k6a9693hpvezz.png" alt=""></p> <p>Then see how your breakpoint is being hit, like so:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/wkeaoqcuszn26bm7fqx4.png" alt=""></p> <h2 id="build-a-rest-api"><a href="#build-a-rest-api" aria-hidden="true" class="header-anchor">#</a> Build a REST API</h2> <p>We would like to do a little bit more than just a simple function, namely to generate a REST API. We won't use a database for this but rather a static class that will hold state.</p> <p>Create an entirely new directory for this and create a new Azure Function App. When asked for the name of a method choose <code>ProductsGet</code> and <code>HttpTrigger</code></p> <p>Then create the following methods using the command palette:</p> <ul><li>ProductCreate</li> <li>ProductGet</li></ul> <p>To generate these methods we bring up the command palette and this time we choose <code>Azure Functions: Create Function</code>. Select <code>HttpTrigger</code> and name. At this point your project should look like this:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/aw8kswrt29kx99fp802n.png" alt=""></p> <p>Now what?</p> <p>We will go through each of the generated classes in order but lets first create the class that will hold our database <code>Db.cs</code></p> <h3 id="creating-the-database"><a href="#creating-the-database" aria-hidden="true" class="header-anchor">#</a> Creating the database</h3> <p>This is just a simple class holding our data but in future articles, we will replace this with an actual database.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Db.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Company <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Db</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>Product<span class="token operator">&gt;</span> products <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Name<span class="token operator">=</span> <span class="token string">&quot;Avengers End Game&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> Name<span class="token operator">=</span> <span class="token string">&quot;Wonder Woman&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> IEnumerable<span class="token operator">&lt;</span>Product<span class="token operator">&gt;</span> <span class="token function">GetProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> products<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Product</span> <span class="token function">GetProductById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> products<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Product</span> <span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token keyword">string</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">var</span> newProduct <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> Id <span class="token operator">=</span> products<span class="token punctuation">.</span>Count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> name<span class="token punctuation">}</span><span class="token punctuation">;</span> 
      products<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>newProduct<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> newProduct<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>As you can see above we create the type <code>Product</code> and the methods <code>GetProducts</code>, <code>GetProductById()</code> and <code>CreateProduct()</code>.</p> <h3 id="list-of-products"><a href="#list-of-products" aria-hidden="true" class="header-anchor">#</a> List of Products</h3> <p>This will return a list of Products and looks pretty simple:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ProductsGet.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging<span class="token punctuation">;</span>
<span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Company<span class="token punctuation">.</span>Function
<span class="token punctuation">{</span>    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProductsGet</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token class-name">FunctionName</span><span class="token punctuation">(</span><span class="token string">&quot;ProductsGet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>IActionResult<span class="token operator">&gt;</span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token class-name">HttpTrigger</span><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Anonymous<span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token class-name">HttpRequest</span> req<span class="token punctuation">,</span>
            <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;C# HTTP trigger function processed a request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> json <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">{</span>
                products <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token function">GetProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token punctuation">(</span>ActionResult<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">OkObjectResult</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>It's worth commenting on how we create the response:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> json <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">{</span>
    products <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token function">GetProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>What we do here is to create a JSON response looking like this:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;products&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token comment">/* list of products*/</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Also worth noting is how we limit the allowed HTTP verb to only <code>get</code>.</p> <h3 id="get-a-specific-product"><a href="#get-a-specific-product" aria-hidden="true" class="header-anchor">#</a> Get a specific Product</h3> <p>Now, this is about asking for a specific Product. We will do that by creating a route like this <code>url/ProductGet/{productid}</code>. The idea is that we find a particular product by typing for example <code>url/ProductGet/1</code>. Let's have a look at the implementation:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ProductGet.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging<span class="token punctuation">;</span>
<span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Company<span class="token punctuation">.</span>Function
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProductGet</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token class-name">FunctionName</span><span class="token punctuation">(</span><span class="token string">&quot;ProductGet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>IActionResult<span class="token operator">&gt;</span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token class-name">HttpTrigger</span><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Anonymous<span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token string">&quot;ProductsGet/{id:int}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token class-name">HttpRequest</span> req<span class="token punctuation">,</span>
            <span class="token keyword">int</span> id<span class="token punctuation">,</span>
            <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;C# HTTP trigger function processed a request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> product <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token function">GetProductById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> json <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span>
                product <span class="token operator">=</span> product
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token punctuation">(</span>ActionResult<span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">OkObjectResult</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>Specifically note how we in our <code>HttpTrigger</code> decorator set the value of <code>Route</code> to <code>ProductsGet/{id:int}</code>. This is a pattern meaning we will respond to request looking like <code>url/ProductsGet/1</code>. There is something else we parse out <code>id</code> from the route by simply typing <code>int id</code>. Then we simply filter out the matching product by the following code below and create our JSON response:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> product <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token function">GetProductById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> json <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span>
    product <span class="token operator">=</span> product
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="create-a-product"><a href="#create-a-product" aria-hidden="true" class="header-anchor">#</a> Create a Product</h3> <p>For this one, we will limit the HTTP verb to <code>post</code>. We will also read from the body and parse out <code>name</code>. The code looks like the following:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// ProductCreate.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Azure<span class="token punctuation">.</span>WebJobs<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Http<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging<span class="token punctuation">;</span>
<span class="token keyword">using</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Company<span class="token punctuation">.</span>Function
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProductCreate</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token class-name">FunctionName</span><span class="token punctuation">(</span><span class="token string">&quot;ProductCreate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span>IActionResult<span class="token operator">&gt;</span> <span class="token function">Run</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token class-name">HttpTrigger</span><span class="token punctuation">(</span>AuthorizationLevel<span class="token punctuation">.</span>Anonymous<span class="token punctuation">,</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> Route <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token class-name">HttpRequest</span> req<span class="token punctuation">,</span>
            <span class="token class-name">ILogger</span> log<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;C# HTTP trigger function processed a request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">string</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

            <span class="token keyword">string</span> requestBody <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;request body&quot;</span><span class="token punctuation">,</span> requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">dynamic</span> data <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">DeserializeObject</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
            name <span class="token operator">=</span> name <span class="token operator">??</span> data<span class="token punctuation">?.</span>name<span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> 
            <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> product <span class="token operator">=</span> Db<span class="token punctuation">.</span><span class="token function">CreateProduct</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> json <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">{</span>
                    product <span class="token operator">=</span> product
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>ActionResult<span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">OkObjectResult</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BadRequestObjectResult</span><span class="token punctuation">(</span><span class="token string">&quot;Missing name in posted Body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>The interesting part here is how we parse out the Body information with this code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">string</span> requestBody <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">LogInformation</span><span class="token punctuation">(</span><span class="token string">&quot;request body&quot;</span><span class="token punctuation">,</span> requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">dynamic</span> data <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">DeserializeObject</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
name <span class="token operator">=</span> name <span class="token operator">??</span> data<span class="token punctuation">?.</span>name<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Other than that the code is pretty straight forward and checks if <code>name</code> was provided in the Body if so go ahead and create it and finally create a JSON response.</p> <h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>Ok, we have done some progress. We have understood the reason for choosing serverless, been able to create two different Azure Function apps, one simpler one that showcases concepts such as dealing with query parameters and body and the other example showcasing a REST API where we are close to production code.</p> <p>This was the first article on Serverless and C# and hopefully, now you grasp the basics. We have only just scratched the surface. The real value lies in the Serverless frameworks ability to set up different triggers and input and output bindings and interact with a lot of other services on Azure.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7aecc4ed.js" defer></script><script src="/assets/js/7.1b275639.js" defer></script><script src="/assets/js/6.6ae5d1ce.js" defer></script><script src="/assets/js/36.589ace7f.js" defer></script>
  </body>
</html>
