<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Learn Kubernetes - from the beginning, part IV, autoscaling</title>
    <meta name="description" content="[object Object]">
    <head link="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-abap.js"></head>
    
    <link rel="preload" href="/assets/css/0.styles.92bf3894.css" as="style"><link rel="preload" href="/assets/js/app.26388f3c.js" as="script"><link rel="preload" href="/assets/js/9.20ba5650.js" as="script"><link rel="preload" href="/assets/js/4.b33b06f6.js" as="script"><link rel="preload" href="/assets/js/101.3eaa2d62.js" as="script"><link rel="prefetch" href="/assets/js/1.76e1fa2c.js"><link rel="prefetch" href="/assets/js/10.5bc7cce6.js"><link rel="prefetch" href="/assets/js/100.7d4da4d2.js"><link rel="prefetch" href="/assets/js/102.20b699c2.js"><link rel="prefetch" href="/assets/js/103.db03b7aa.js"><link rel="prefetch" href="/assets/js/104.c802d704.js"><link rel="prefetch" href="/assets/js/105.0856b4fa.js"><link rel="prefetch" href="/assets/js/106.4dfe3d4d.js"><link rel="prefetch" href="/assets/js/107.daffe558.js"><link rel="prefetch" href="/assets/js/108.2465f7cf.js"><link rel="prefetch" href="/assets/js/109.2bdf55df.js"><link rel="prefetch" href="/assets/js/11.393f848d.js"><link rel="prefetch" href="/assets/js/110.5f942d10.js"><link rel="prefetch" href="/assets/js/111.0fd60c24.js"><link rel="prefetch" href="/assets/js/112.d64efa07.js"><link rel="prefetch" href="/assets/js/113.1e20cdd2.js"><link rel="prefetch" href="/assets/js/114.865941ce.js"><link rel="prefetch" href="/assets/js/115.7d935e27.js"><link rel="prefetch" href="/assets/js/116.fcc98a0d.js"><link rel="prefetch" href="/assets/js/117.5c57dd4a.js"><link rel="prefetch" href="/assets/js/118.264454f3.js"><link rel="prefetch" href="/assets/js/119.25f0debc.js"><link rel="prefetch" href="/assets/js/12.0ed640a1.js"><link rel="prefetch" href="/assets/js/120.e081fd4a.js"><link rel="prefetch" href="/assets/js/13.9b870990.js"><link rel="prefetch" href="/assets/js/14.cc3491a4.js"><link rel="prefetch" href="/assets/js/15.e392c70f.js"><link rel="prefetch" href="/assets/js/16.019de8ce.js"><link rel="prefetch" href="/assets/js/17.c74abd7b.js"><link rel="prefetch" href="/assets/js/18.4ab7403e.js"><link rel="prefetch" href="/assets/js/19.ae2840ee.js"><link rel="prefetch" href="/assets/js/20.09f9c6ec.js"><link rel="prefetch" href="/assets/js/21.4b8a4546.js"><link rel="prefetch" href="/assets/js/22.976a3745.js"><link rel="prefetch" href="/assets/js/23.d4b48fdb.js"><link rel="prefetch" href="/assets/js/24.297c5891.js"><link rel="prefetch" href="/assets/js/25.077254a4.js"><link rel="prefetch" href="/assets/js/26.75dd9db7.js"><link rel="prefetch" href="/assets/js/27.dcb00858.js"><link rel="prefetch" href="/assets/js/28.a4db86ee.js"><link rel="prefetch" href="/assets/js/29.9d917509.js"><link rel="prefetch" href="/assets/js/3.95140222.js"><link rel="prefetch" href="/assets/js/30.e2c51e74.js"><link rel="prefetch" href="/assets/js/31.2f6479c3.js"><link rel="prefetch" href="/assets/js/32.68a73a81.js"><link rel="prefetch" href="/assets/js/33.6407b065.js"><link rel="prefetch" href="/assets/js/34.088d869f.js"><link rel="prefetch" href="/assets/js/35.74235618.js"><link rel="prefetch" href="/assets/js/36.1f9582f8.js"><link rel="prefetch" href="/assets/js/37.bf5d6087.js"><link rel="prefetch" href="/assets/js/38.5b6560fc.js"><link rel="prefetch" href="/assets/js/39.e5757cb4.js"><link rel="prefetch" href="/assets/js/40.9ed5a9e0.js"><link rel="prefetch" href="/assets/js/41.b40ed077.js"><link rel="prefetch" href="/assets/js/42.4172e39e.js"><link rel="prefetch" href="/assets/js/43.b152737d.js"><link rel="prefetch" href="/assets/js/44.19adf854.js"><link rel="prefetch" href="/assets/js/45.4705ec48.js"><link rel="prefetch" href="/assets/js/46.04efbaf9.js"><link rel="prefetch" href="/assets/js/47.cd593f3b.js"><link rel="prefetch" href="/assets/js/48.57ed38b2.js"><link rel="prefetch" href="/assets/js/49.1b30035f.js"><link rel="prefetch" href="/assets/js/5.44d1fb4e.js"><link rel="prefetch" href="/assets/js/50.7fe77565.js"><link rel="prefetch" href="/assets/js/51.16083d55.js"><link rel="prefetch" href="/assets/js/52.222f6cb2.js"><link rel="prefetch" href="/assets/js/53.e9b90e93.js"><link rel="prefetch" href="/assets/js/54.649fb5ce.js"><link rel="prefetch" href="/assets/js/55.036e444e.js"><link rel="prefetch" href="/assets/js/56.297fda50.js"><link rel="prefetch" href="/assets/js/57.a55e641d.js"><link rel="prefetch" href="/assets/js/58.78d82242.js"><link rel="prefetch" href="/assets/js/59.bda880a8.js"><link rel="prefetch" href="/assets/js/6.67cc1f3f.js"><link rel="prefetch" href="/assets/js/60.8d4e87f5.js"><link rel="prefetch" href="/assets/js/61.aa8ee057.js"><link rel="prefetch" href="/assets/js/62.c27f5f3f.js"><link rel="prefetch" href="/assets/js/63.bce219b7.js"><link rel="prefetch" href="/assets/js/64.6e2381f6.js"><link rel="prefetch" href="/assets/js/65.d8a69dca.js"><link rel="prefetch" href="/assets/js/66.8a35e415.js"><link rel="prefetch" href="/assets/js/67.18e461c8.js"><link rel="prefetch" href="/assets/js/68.6f6b80b0.js"><link rel="prefetch" href="/assets/js/69.cc8504ff.js"><link rel="prefetch" href="/assets/js/7.c663ff3b.js"><link rel="prefetch" href="/assets/js/70.6d130260.js"><link rel="prefetch" href="/assets/js/71.32090224.js"><link rel="prefetch" href="/assets/js/72.120c008d.js"><link rel="prefetch" href="/assets/js/73.7968ba45.js"><link rel="prefetch" href="/assets/js/74.6223b8aa.js"><link rel="prefetch" href="/assets/js/75.6e2fbfbe.js"><link rel="prefetch" href="/assets/js/76.c8afe4ea.js"><link rel="prefetch" href="/assets/js/77.85dfd29a.js"><link rel="prefetch" href="/assets/js/78.48b6dd73.js"><link rel="prefetch" href="/assets/js/79.f4800a89.js"><link rel="prefetch" href="/assets/js/8.988484b0.js"><link rel="prefetch" href="/assets/js/80.950ead2a.js"><link rel="prefetch" href="/assets/js/81.93f56455.js"><link rel="prefetch" href="/assets/js/82.909d5110.js"><link rel="prefetch" href="/assets/js/83.9e3357aa.js"><link rel="prefetch" href="/assets/js/84.602dfc87.js"><link rel="prefetch" href="/assets/js/85.f5ebffe9.js"><link rel="prefetch" href="/assets/js/86.4acc7392.js"><link rel="prefetch" href="/assets/js/87.6401c50e.js"><link rel="prefetch" href="/assets/js/88.c7c4444e.js"><link rel="prefetch" href="/assets/js/89.9837a1df.js"><link rel="prefetch" href="/assets/js/90.dc8ae67f.js"><link rel="prefetch" href="/assets/js/91.cb72f099.js"><link rel="prefetch" href="/assets/js/92.7fad9f42.js"><link rel="prefetch" href="/assets/js/93.b499e50b.js"><link rel="prefetch" href="/assets/js/94.9d0cd305.js"><link rel="prefetch" href="/assets/js/95.b5f7873d.js"><link rel="prefetch" href="/assets/js/96.61c5e02c.js"><link rel="prefetch" href="/assets/js/97.cd67c643.js"><link rel="prefetch" href="/assets/js/98.34e5195f.js"><link rel="prefetch" href="/assets/js/99.fb6f5121.js">
    <link rel="stylesheet" href="/assets/css/0.styles.92bf3894.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Learn Kubernetes - from the beginning, part IV, autoscaling</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes-four.html#resources" class="sidebar-link">Resources</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/kubernetes-four.html#why" class="sidebar-link">Why</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/kubernetes-four.html#how" class="sidebar-link">How</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/kubernetes-four.html#lab-lets-scale" class="sidebar-link">Lab - lets scale</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/kubernetes-four.html#set-up" class="sidebar-link">Set up</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes-four.html#running-the-experiment" class="sidebar-link">Running the experiment</a></li></ul></li><li><a href="/pages/kubernetes-four.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="learn-kubernetes-from-the-beginning-part-iv-autoscaling"><a href="#learn-kubernetes-from-the-beginning-part-iv-autoscaling" aria-hidden="true" class="header-anchor">#</a> Learn Kubernetes - from the beginning, part IV, autoscaling</h1> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/8fku1pggqh7odrul66fc.jpg" alt=""></p> <blockquote><p>This fourth part aims to show you how you can utilize auto-scaling as your scaling strategy. We've shown you scaling with a <em>desired state</em> but this is probably even more powerful</p></blockquote> <ul><li><p><a href="https://softchris.github.io/pages/kubernetes-one.html" target="_blank" rel="noopener noreferrer">Part I - from the beginning, Part I, Basics, Deployment and Minikube<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
In this part, we cover why Kubernetes, some history and some basic concepts like deploying, Nodes, Pods.</p></li> <li><p><a href="https://softchris.github.io/pages/kubernetes-two.html" target="_blank" rel="noopener noreferrer">Part II - introducing Services and Labeling<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
In this part, we deepen our knowledge on Pods and Nodes. We also introduce Services and labeling using labels to query our artifacts.</p></li> <li><p><a href="https://softchris.github.io/pages/kubernetes-three.html" target="_blank" rel="noopener noreferrer">Part III - Scaling<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
In this part, we look at scaling using <em>desired</em> state. We specify how many Pods we want and let Kubernetes do the heavy lifting in terms of ensuring that your Pods are scaled up to the desired number but also maintaining it by using something called self-healing.</p></li> <li><p>Part IV - Auto scaling <strong>We are here</strong></p></li></ul> <p>In this article, we will cover the following:</p> <ul><li><strong>Why auto scaling</strong>, we will discuss different scenarios in which it makes sense to rely on <em>auto scaling</em> over defining it statically like we do with <em>desired state</em></li> <li><strong>How</strong>, lets talk about Horizontal Auto Scaling the concept/feature that allows us to scale in an elastic way.</li> <li><strong>Lab - lets scale</strong>, we will look at how to actually set this up in <code>kubectl</code> and simulate a ton of incoming requests. We will then inspect the results and see that Kubernetes acts the way we think</li></ul> <h2 id="resources"><a href="#resources" aria-hidden="true" class="header-anchor">#</a> Resources</h2> <ul><li><a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noopener noreferrer">Horizontal Pod Auto scale<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> This describes in detail how everything works. On a flow as well as API level</li> <li><a href="https://azure.microsoft.com/en-gb/free/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Free Azure Account<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> If you want to try out AKS, Azure Kubernetes Service, you will need a free Azure account</li> <li><a href="https://kubernetes.io" target="_blank" rel="noopener noreferrer">Kubernetes.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
One of the best resources to learn about Kubernetes is at this official Kubernetes site by Google.</li> <li><a href="https://azure.microsoft.com/en-gb/topic/kubernetes/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Kubernetes overview<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> An overview of Kubernetes, all its parts and how it works</li> <li><a href="https://azure.microsoft.com/en-gb/services/kubernetes-service/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Kubernetes in the Cloud<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Do you feel you know everything about Kubernetes already and just want to learn how to use a managed service? Then this link is for you</li> <li><a href="https://docs.microsoft.com/en-gb/azure/aks/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Documentation on AKS, Azure Kubernetes Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
Azure Kubernetes Service, a managed Kubernetes</li> <li><a href="https://docs.microsoft.com/en-us/azure/aks/best-practices?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Best practices on AKS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> You already know AKS and want to learn how to use it better?</li></ul> <h2 id="why"><a href="#why" aria-hidden="true" class="header-anchor">#</a> Why</h2> <p>So in our last part, we talked about <em>desired state</em>. That's an OK strategy until something unforeseen happens and suddenly you got a great influx of traffic. This is likely to happen to businesses such as e-commerce around a big sale or a ticket vendor when you release tickets to a popular event.</p> <p>Events like these are an anomaly which forces you to quickly scale up. The other side of the coin though is that at some point you need to scale down or you suddenly have overcapacity you might need to pay for. What you really want is for the scaling to act in an <em>elastic</em> way so it scaled up when you need it to and scales down when there is less traffic.</p> <h2 id="how"><a href="#how" aria-hidden="true" class="header-anchor">#</a> How</h2> <p>Horizontal auto-scaling, what does it mean?</p> <p>It's a concept in Kubernetes that can scale the number of Pods we need. It can do so on a <code>replication controller</code>, <code>deployment</code> or <code>replica set</code>.  It usually looks at CPU utilization but can be made to look at other things by using something called <code>custom metrics support</code>, so it's customizable.</p> <p>It consists of two parts a <code>resource</code> and a <code>controller</code>. The <code>controller</code> checks utilization, or whatever metric you decided, to ensure that the number of replicas matches your specification. If need be it spins up more Pods or removes them. The default is checking every <code>15</code> seconds but you can change that by looking at a flag called <code>--horizontal-pod-autoscaler-sync-period</code>.</p> <p>The underlying algorithm that decides the number of replicas looks like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>desiredReplicas = ceil[currentReplicas * ( currentMetricValue / desiredMetricValue )]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="lab-lets-scale"><a href="#lab-lets-scale" aria-hidden="true" class="header-anchor">#</a> Lab - lets scale</h2> <p>Ok, the first thing we need to do is to scale our deployment to use something other than <em>desired state</em>.</p> <p>We have two things we need to specify when we do autoscaling:</p> <ul><li><strong>min/max</strong>, we define a minimum and maximum in terms of how many Pods we want</li> <li><strong>CPU</strong>, in this version we set a certain CPU utilization percentage. When it goes above that it scales out as needed. Think of this one as an <code>IF</code> clause, if CPU value greater than the threshold, try to scale</li></ul> <h3 id="set-up"><a href="#set-up" aria-hidden="true" class="header-anchor">#</a> Set up</h3> <p>Before we can attempt our scaling experiment we need to make sure we have the correct add-ons enabled. You can easily see what add-ons you have enabled by typing:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>minikube addons list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://thepracticaldev.s3.amazonaws.com/i/dyxueq0x7j2q0ybfgxq4.png" alt=""></p> <p>If it looks like the above we are all good. Why am I saying that? Well, what we need, to be able to auto-scale, is that <code>heapster</code> and <code>metrics-server</code> add ons are enabled.</p> <p>Heapster enables Container Cluster Monitoring and Performance Analysis.</p> <p>Metrics server provide metrics via the resource metrics API. Horizontal Pod Autoscaler uses this API to collect metrics</p> <p>We can easily enable them both with the following commands (we will need to for auto-scaling to show correct data):</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>minikube addons enable heapster
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>and</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>minikube addons enable metrics-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>We need to do one more thing, namely to <code>enable</code> <em>Custom metrics</em>, which we do by starting <code>minikube</code> with such a flag like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>minikube start --extra-config kubelet.EnableCustomMetrics=true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Ok, now we are good to go.</p> <h3 id="running-the-experiment"><a href="#running-the-experiment" aria-hidden="true" class="header-anchor">#</a> Running the experiment</h3> <p>We need to do the following to run our experiment</p> <ul><li><strong>Create</strong> a deployment</li> <li><strong>Apply</strong> autoscaling</li> <li><strong>Bombard</strong> the deployment with incoming requests</li> <li><strong>Watch</strong> the auto scaling how it changes</li></ul> <h4 id="create-a-deployment"><a href="#create-a-deployment" aria-hidden="true" class="header-anchor">#</a> Create a deployment</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl run php-apache --image=k8s.gcr.io/hpa-example --requests=cpu=200m --expose --port=80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Above we are creating a deployment <code>php-apache</code> and expose it as a service on port <code>80</code>. We can see that we are using the image <code>k8s.gcr.io/hpa-example</code></p> <p>It should tell us the following:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>service/php-apache created
deployment.apps/php-apache created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="autoscaling"><a href="#autoscaling" aria-hidden="true" class="header-anchor">#</a> Autoscaling</h4> <p>Next up we will use the command <code>autoscale</code>. We will use it like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>It should say something like:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>horizontalpodautoscaler.autoscaling/php-apache autoscaled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Above we are applying the auto-scaling on the deployment <code>php-apache</code> and as you can see we are applying both <code>min-max</code> and <code>cpu</code> based auto scaling which means we give a rule for how the auto scaling should happen:</p> <blockquote><p>If CPU load is <code>&gt;= 50%</code> create a new Pod, but only maximum 10 Pods. If the load is low go back gradually to one Pod</p></blockquote> <h4 id="bombard-with-requests"><a href="#bombard-with-requests" aria-hidden="true" class="header-anchor">#</a> Bombard with requests</h4> <p>Next step is to send a ton of requests against our deployment and see our auto-scaling doing its work. So how do we do that?</p> <p>First off let's check the current status of our <em>horizontal pod auto-scaler</em> or <code>hpa</code> for short by typing:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get hpa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This should give us something like this:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/0pxx5qqkkcq2buz6wxfd.png" alt=""></p> <p>The above shows us two pieces of information. The first is the <code>TARGETS</code> column which shows our CPU utilization, <code>actual usage/trigger value</code>. The next bit of interest is the column <code>REPLICAS</code> that shows us the number of copies, which is <code>1</code> at the moment.</p> <p>For our next trick open up a separate terminal tab. We need to do is to set things up so we can send a ton of requests.</p> <p>Next up we create a container using this command:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl run -i --tty load-generator --image=busybox /bin/sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This should take us to a prompt within the container. This is followed by:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>while true; do wget -q -O- http://php-apache.default.svc.cluster.local; done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The command above should result in something looking like this.</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/55so6diaa2y7h3jai792.png" alt=""></p> <p>This will just go on and on until you hit <code>CTRL+C</code>, but leave it be for now.</p> <p>This throws a ton on requests in <code>while true</code> loop.</p> <blockquote><p>I thought <code>while true</code> loops were bad?</p></blockquote> <p>They are but we are only going to run it for a minute so that the auto scaling can happen. Yes, the CPU will sound a lot but don't worry ðŸ˜ƒ</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/5bcbz91175tjpj461hh8.gif" alt=""></p> <p>Let this go on for a minute or so, then enter the following command into the first terminal tab (not the one running the requests), like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get hpa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>It should now show something like this:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/szvti1xjqkgp10xa5e73.png" alt=""></p> <p>As you can see from the above the column <code>TARGETS</code> looks different and now says <code>339%/50%</code> which means the current load on the CPU and <code>REPLICAS</code> is <code>7</code> which means it has gone from 1 to 7 replicas. So as you can see we have been bombarding it pretty hard.</p> <p>Now go to the second terminal and hit <code>CTRL+C</code> or you will have a situation like this:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/66wm4drplfxlcuspf90k.gif" alt=""></p> <p>It will actually take a few minutes for Kubernetes to cool off and get the values back to normal. A first look at the Pods situation shows us the following:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pods
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://thepracticaldev.s3.amazonaws.com/i/4ikq562c45z7k65su7j9.png" alt=""></p> <p>As you can see we have 7 Pods up and running still but let's wait a minute or two and it should look like this:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/39x2p1dg3f2i3nwg9jl4.png" alt=""></p> <p>Ok, now we are back to normal.</p> <h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>Now we did some great stuff in this article. We managed to set up auto-scaling, bombard it with requests and without frying our CPU, hopefully ðŸ˜‰</p> <p>We also managed to learn some new Kubernetes commands while at it and got to see <em>auto-scaling</em> at work giving us new Pods based on our specification.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.26388f3c.js" defer></script><script src="/assets/js/9.20ba5650.js" defer></script><script src="/assets/js/4.b33b06f6.js" defer></script><script src="/assets/js/101.3eaa2d62.js" defer></script>
  </body>
</html>
