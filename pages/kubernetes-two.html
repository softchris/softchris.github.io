<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Learn Kubernetes - from the beginning, part II, Pods, Nodes and Services</title>
    <meta name="description" content="[object Object]">
    
    
    <link rel="preload" href="/assets/css/0.styles.b244743b.css" as="style"><link rel="preload" href="/assets/js/app.1077fdd6.js" as="script"><link rel="preload" href="/assets/js/7.1b275639.js" as="script"><link rel="preload" href="/assets/js/6.6ae5d1ce.js" as="script"><link rel="preload" href="/assets/js/55.af78a3a1.js" as="script"><link rel="prefetch" href="/assets/js/1.1b576644.js"><link rel="prefetch" href="/assets/js/10.7bac90a4.js"><link rel="prefetch" href="/assets/js/11.01a6b72e.js"><link rel="prefetch" href="/assets/js/12.004aabb2.js"><link rel="prefetch" href="/assets/js/13.ce52cddb.js"><link rel="prefetch" href="/assets/js/14.b6e0c6b9.js"><link rel="prefetch" href="/assets/js/15.07067913.js"><link rel="prefetch" href="/assets/js/16.50314d1a.js"><link rel="prefetch" href="/assets/js/17.7ce6a9cd.js"><link rel="prefetch" href="/assets/js/18.eda17916.js"><link rel="prefetch" href="/assets/js/19.cd61a8a6.js"><link rel="prefetch" href="/assets/js/20.a4d63b29.js"><link rel="prefetch" href="/assets/js/21.8ccc4b4a.js"><link rel="prefetch" href="/assets/js/22.5e93f2ba.js"><link rel="prefetch" href="/assets/js/23.dfa71c99.js"><link rel="prefetch" href="/assets/js/24.b508333a.js"><link rel="prefetch" href="/assets/js/25.3e09c98a.js"><link rel="prefetch" href="/assets/js/26.5d960c66.js"><link rel="prefetch" href="/assets/js/27.9a5480bd.js"><link rel="prefetch" href="/assets/js/28.7bbac0cf.js"><link rel="prefetch" href="/assets/js/29.98080ec7.js"><link rel="prefetch" href="/assets/js/3.262e56e6.js"><link rel="prefetch" href="/assets/js/30.40bf3c4e.js"><link rel="prefetch" href="/assets/js/31.c890fac6.js"><link rel="prefetch" href="/assets/js/32.c7f0736b.js"><link rel="prefetch" href="/assets/js/33.6ca47a2f.js"><link rel="prefetch" href="/assets/js/34.7a1dc0cf.js"><link rel="prefetch" href="/assets/js/35.6cf65d37.js"><link rel="prefetch" href="/assets/js/36.695fee10.js"><link rel="prefetch" href="/assets/js/37.31210639.js"><link rel="prefetch" href="/assets/js/38.047f8b64.js"><link rel="prefetch" href="/assets/js/39.6552e1ac.js"><link rel="prefetch" href="/assets/js/4.56ae630c.js"><link rel="prefetch" href="/assets/js/40.3699c732.js"><link rel="prefetch" href="/assets/js/41.2d165e9d.js"><link rel="prefetch" href="/assets/js/42.b3f5dc5b.js"><link rel="prefetch" href="/assets/js/43.a9f2029b.js"><link rel="prefetch" href="/assets/js/44.da684f41.js"><link rel="prefetch" href="/assets/js/45.8f727a31.js"><link rel="prefetch" href="/assets/js/46.ba246365.js"><link rel="prefetch" href="/assets/js/47.0a9a1060.js"><link rel="prefetch" href="/assets/js/48.f3983d5c.js"><link rel="prefetch" href="/assets/js/49.9aaf4a92.js"><link rel="prefetch" href="/assets/js/5.373600b1.js"><link rel="prefetch" href="/assets/js/50.ee242d5e.js"><link rel="prefetch" href="/assets/js/51.70b601ff.js"><link rel="prefetch" href="/assets/js/52.c3a923fb.js"><link rel="prefetch" href="/assets/js/53.7912b855.js"><link rel="prefetch" href="/assets/js/54.1d98eb4a.js"><link rel="prefetch" href="/assets/js/56.019c6498.js"><link rel="prefetch" href="/assets/js/57.efbda61a.js"><link rel="prefetch" href="/assets/js/58.9bcc2893.js"><link rel="prefetch" href="/assets/js/59.2bf33e43.js"><link rel="prefetch" href="/assets/js/60.0a77889c.js"><link rel="prefetch" href="/assets/js/61.3717cfbc.js"><link rel="prefetch" href="/assets/js/62.df5410c6.js"><link rel="prefetch" href="/assets/js/63.cf37fa68.js"><link rel="prefetch" href="/assets/js/64.608fde42.js"><link rel="prefetch" href="/assets/js/65.b497f5f9.js"><link rel="prefetch" href="/assets/js/66.74cfc266.js"><link rel="prefetch" href="/assets/js/67.ab455053.js"><link rel="prefetch" href="/assets/js/68.c76ed714.js"><link rel="prefetch" href="/assets/js/69.2d7ac801.js"><link rel="prefetch" href="/assets/js/70.371523a9.js"><link rel="prefetch" href="/assets/js/71.d17d186a.js"><link rel="prefetch" href="/assets/js/8.a354cea0.js"><link rel="prefetch" href="/assets/js/9.be23d1a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b244743b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Learn Kubernetes - from the beginning, part II, Pods, Nodes and Services</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/kubernetes-two.html#resources" class="sidebar-link">Resources</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/kubernetes-two.html#concepts-revisited" class="sidebar-link">Concepts revisited</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/kubernetes-two.html#pods" class="sidebar-link">Pods</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes-two.html#nodes" class="sidebar-link">Nodes</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes-two.html#services" class="sidebar-link">Services</a></li></ul></li><li><a href="/pages/kubernetes-two.html#labels" class="sidebar-link">Labels</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/kubernetes-two.html#lab-fun-with-labels-and-kubectl" class="sidebar-link">Lab - Fun with Labels and kubectl</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/kubernetes-two.html#creating-and-applying-labels" class="sidebar-link">Creating and applying Labels</a></li><li class="sidebar-sub-header"><a href="/pages/kubernetes-two.html#clean-up" class="sidebar-link">Clean up</a></li></ul></li><li><a href="/pages/kubernetes-two.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="learn-kubernetes-from-the-beginning-part-ii-pods-nodes-and-services"><a href="#learn-kubernetes-from-the-beginning-part-ii-pods-nodes-and-services" aria-hidden="true" class="header-anchor">#</a> Learn Kubernetes - from the beginning, part II, Pods, Nodes and Services</h1> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/3ftzrfi7279p3ndiz14e.jpg" alt=""></p> <blockquote><p>This second part aims to give additional context to Nodes, Pods and introduce the concept Service. There is some theory and some practice with Kubectl.</p></blockquote> <p>Welcome back to this second part. By now concepts such <code>kubectl</code>, <code>nodes</code> and <code>pods</code> shouldn't be completely new to you but we will mention a little bit more what they are and of course, we will keep on learning about Kubernetes using our tool <code>kubectl</code>. We will also introduce the new concept of Services and how they are a better choice than a proxy to expose your apps.</p> <p>This is part of a series of articles on Kubernetes:</p> <ul><li><a href="https://softchris.github.io/pages/kubernetes-one.html" target="_blank" rel="noopener noreferrer">Part I - from the beginning, Part I, Basics, Deployment and Minikube<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
In this part, we cover why Kubernetes, some history and some basic concepts like deploying, Nodes, Pods.</li> <li>Part II introducing Services and Labeling - <strong>we are here</strong></li> <li><a href="https://softchris.github.io/pages/kubernetes-three.html" target="_blank" rel="noopener noreferrer">Part III - scaling<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
Here we cover how to scale and further show how <em>desired state</em> is high-level instruction to Kubernetes. We also explain self-healing and briefly touch on auto-scaling.</li> <li><a href="https://softchris.github.io/pages/kubernetes-four.html" target="_blank" rel="noopener noreferrer">Part IV - Auto scaling<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> In this part we look at how to set up auto-scaling so we can handle sudden large increases of incoming requests</li></ul> <p>In this part we will cover the following:</p> <ul><li><strong>Deepen</strong> our knowledge on Pods and Nodes</li> <li><strong>Introduce</strong> Services and labeling</li> <li><strong>Perform</strong> an exercise, involving setting labels on Pods and use labels to query our artifacts</li></ul> <h2 id="resources"><a href="#resources" aria-hidden="true" class="header-anchor">#</a> Resources</h2> <ul><li><a href="https://azure.microsoft.com/en-gb/free/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Free Azure Account<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> If you want to try out AKS, Azure Kubernetes Service, you will need a free Azure account</li> <li><a href="https://kubernetes.io" target="_blank" rel="noopener noreferrer">Kubernetes.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
One of the best resources to learn about Kubernetes is at this official Kubernetes site by Google.</li> <li><a href="https://azure.microsoft.com/en-gb/topic/kubernetes/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Kubernetes overview<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> An overview of Kubernetes, all its parts and how it works</li> <li><a href="https://azure.microsoft.com/en-gb/services/kubernetes-service/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Kubernetes in the Cloud<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Do you feel you know everything about Kubernetes already and just want to learn how to use a managed service? Then this link is for you</li> <li><a href="https://docs.microsoft.com/en-gb/azure/aks/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Documentation on AKS, Azure Kubernetes Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
Azure Kubernetes Service, a managed Kubernetes</li> <li><a href="https://docs.microsoft.com/en-us/azure/aks/best-practices?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Best practices on AKS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> You already know AKS and want to learn how to use it better?</li></ul> <h2 id="concepts-revisited"><a href="#concepts-revisited" aria-hidden="true" class="header-anchor">#</a> Concepts revisited</h2> <p>When we create a Deployment on Kubernetes, that Deployment creates Pods with containers inside them. So Pods are tied to Nodes and will continue to exist until <em>terminated</em> or <em>deleted</em>. Let's try to educate ourselves a bit more on Pods, Nodes and let's also introduce a new topic <em>Services</em>.</p> <h3 id="pods"><a href="#pods" aria-hidden="true" class="header-anchor">#</a> Pods</h3> <blockquote><p>Pods are the atomic unit on the Kubernetes platform, i.e smallest possible deployable unit</p></blockquote> <p>We've stated the above before but it's worth mentioning again.</p> <blockquote><p>What else is there to know?</p></blockquote> <p>A Pod is an abstraction that represents a group of one or more containers, for example, Docker or rkt, and some shared resources for those containers. Those resources include:</p> <ul><li><strong>Shared storage</strong>, as Volumes</li> <li><strong>Networking</strong>, as a unique cluster IP address</li> <li><strong>Information</strong> about how to run each container, such as the container image version or specific ports to use</li></ul> <p>A Pod can have more than one container. If it does contain more than one container it is so the other containers can support the primary application.
Typical examples of helper applications are data pullers, data pushers, and proxies. You can read more on that use case <a href="https://www.mirantis.com/blog/multi-container-pods-and-container-communication-in-kubernetes/" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li>The containers in a Pod share an IP Address and port space and are:</li> <li><strong>Always</strong> co-located</li> <li><strong>Co-scheduled</strong></li></ol> <p>Let me show you an image to make it easier to visualize:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/rf5si3jtu812j9yfw3sa.png" alt=""></p> <p>As we can see above a Pod can have a lot of different artifacts in them that are able to communicate and support the app in some way.</p> <h3 id="nodes"><a href="#nodes" aria-hidden="true" class="header-anchor">#</a> Nodes</h3> <p>A Pod always runs on a Node</p> <blockquote><p>So Node is the Pods parent?</p></blockquote> <p>Yes.</p> <p>A Node is a worker machine and may be either a virtual or a physical machine, depending on the cluster</p> <p>Each Node is managed by the Master. A Node can have multiple pods.</p> <blockquote><p>So it's a one to many relationship</p></blockquote> <p>The Kubernetes master automatically handles scheduling the pods across the Nodes in the cluster</p> <p>Every Kubernetes Node runs at least a:</p> <ul><li><p><strong>Kubelet</strong>, is responsible for the pod spec and talks to the cri interface</p></li> <li><p><strong>Kube proxy</strong>, is the main interface for coms between nodes</p></li> <li><p><strong>A container runtime</strong>, (like Docker, rkt) responsible for pulling the container image from a registry, unpacking the container, and running the application.</p></li></ul> <blockquote><p>Ok so a Node contains a Kubelet and container runtime and one to many Pods. I think I got it.</p></blockquote> <p>Let's show an image to make this info stick, cause it's quite important that we know what goes on, at least at a high level:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/rfvpt1fawgau4h35qju6.png" alt=""></p> <h3 id="services"><a href="#services" aria-hidden="true" class="header-anchor">#</a> Services</h3> <p>Pods are <strong>mortal</strong>, they can die. Pods, in fact, have a <em>lifecycle</em>.</p> <p>When a worker node dies, the Pods running on the Node are also lost.</p> <blockquote><p>What happens to our apps? ðŸ˜¦</p></blockquote> <p>You might think them and their data are lost but not so. The whole point with Kubernetes is to not let that happen. We normally deploy something like a <code>ReplicaSet</code>.</p> <blockquote><p>A ReplicaSet, what do you mean?</p></blockquote> <p>A <code>ReplicaSet</code> is a high-level artifact that can drive the cluster back to <em>desired state</em> via the creation of new Pods to keep your application running.</p> <blockquote><p>Ok so if a Pod goes down the ReplicaSet just creates a new Pod/s in its place?</p></blockquote> <p>Yes, exactly that. If you focus on defining a <em>desired state</em> the rest is up to Kubernetes.</p> <blockquote><p>Phew sounds really great then.</p></blockquote> <p>This concept of <em>desired state</em> is a very important one. You need to specify how many containers you want of each kind, at all times.</p> <blockquote><p>Oh so 4 database containers, 3 services etc?</p></blockquote> <p>Yes exactly.</p> <p>So you don't have to care about the details just tell Kubernetes what state you want and it does the rest. If something goes up, Kubernetes ensures it comes back up again to <em>desired state</em>.</p> <p>Each Pod in a Kubernetes cluster has a unique IP address, even Pods on the same Node, so there needs to be a way of automatically reconciling changes among Pods so that your applications continue to function.</p> <blockquote><p>Ok?</p></blockquote> <p>Yea, think like this. If a Pod containing your app goes down and another Pod is created in its place, running your app. Users should still be able to use your app after that.</p> <blockquote><p>Ok I got it. Makes me think...</p></blockquote> <h4 id="the-motivation-for-a-service"><a href="#the-motivation-for-a-service" aria-hidden="true" class="header-anchor">#</a> The motivation for a Service</h4> <p>You should never refer to a Pod by it's IP address, just think what happens when a Pod goes down and comes back up again but this time with a different IP. It is for that reason a Service exists.</p> <p>A Service in Kubernetes is an abstraction which defines a logical set of Pods and a policy by which to access them.</p> <blockquote><p>Makes me think of a routers and subnets</p></blockquote> <p>Yea I guess you can say there is a resemblance in there somewhere.</p> <p>Services enable a loose coupling between dependent Pods and are defined using YAML or JSON file, just like all Kubernetes objects.</p> <blockquote><p>That's handy, just JSON and YAML ðŸ˜ƒ</p></blockquote> <h4 id="services-and-labels"><a href="#services-and-labels" aria-hidden="true" class="header-anchor">#</a> Services and Labels</h4> <p>The set of Pods targeted by a Service is usually determined by a <code>LabelSelector</code>.</p> <p>Although each Pod has a unique IP address, those IPs are not exposed outside the cluster without a Service. We can expose them through a proxy though as we showed in part I.</p> <blockquote><p>Wait, go back a second here, you said <code>LabelSelector</code>. I wasn't quite following?</p></blockquote> <p>Remember how we couldn't refer to Pods by IP, cause Pods might go down and a new Pod could come back in its place?</p> <blockquote><p>Yes</p></blockquote> <p>Well, labels are the answer to how Services and Pods are able to communicate. This is what we mean by loose coupling. By applying labels like for example <em>frontend</em>, <em>backend</em>, <em>release</em> and so on to Pods, we are able to refer to Pods by their logical name rather than their specifics, i.e IP number.</p> <blockquote><p>Oh I get it, so it's a high-level domain language</p></blockquote> <p>Mm, kind of.</p> <h4 id="services-and-traffic"><a href="#services-and-traffic" aria-hidden="true" class="header-anchor">#</a> Services and Traffic</h4> <p>Services allow your applications to receive traffic.</p> <p>Services can be exposed in different ways by specifying a <code>type</code> in <code>ServiceSpec</code>, service specification.</p> <ul><li><strong>ClusterIP (default)</strong>, Exposes the Service on an internal IP in the cluster. This type makes the Service only reachable from within the cluster.</li> <li><strong>NodePort</strong>, Exposes the Service on the same port of each selected Node in the cluster using NAT. Makes a Service accessible from outside the cluster using <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>. Superset of ClusterIP.</li> <li><strong>LoadBalancer</strong>, Creates an external load balancer in the current cloud (if supported) and assigns a fixed, external IP to the Service. Superset of NodePort.</li> <li><strong>ExternalName</strong>, Exposes the Service using an arbitrary name (specified by <code>externalName</code> in the spec) by returning a CNAME record with the name. No proxy is used. This type requires v1.7 or higher of kube-dns.</li></ul> <blockquote><p>Ok I think I get it. Ensure I'm speaking externally to a Service instead of specific Pods. Depending on what I expose the Service as, that leads to different behavior?</p></blockquote> <p>Yea that's correct.</p> <blockquote><p>You said something about labels though, how do we create and apply them to Pods?</p></blockquote> <p>Yea lets talk about that next.</p> <h2 id="labels"><a href="#labels" aria-hidden="true" class="header-anchor">#</a> Labels</h2> <p>As we just mentioned, Services are the abstraction that allows pods to die and replicate in Kubernetes without impacting your application.</p> <p>Now, Services <em>match</em> a set of Pods using <em>labels</em> and <em>selectors</em>, it allows us to operate on Pods like a group.</p> <p>Labels are key/value pairs attached to objects and can be used in any number of ways:</p> <ul><li><strong>Designate</strong> objects for development, test, and production</li> <li><strong>Embed</strong> version tags</li> <li><strong>Classify</strong> an object using tags</li></ul> <p>Labels can be attached to objects at creation time or later on. They can be modified at any time.</p> <h2 id="lab-fun-with-labels-and-kubectl"><a href="#lab-fun-with-labels-and-kubectl" aria-hidden="true" class="header-anchor">#</a> Lab - Fun with Labels and kubectl</h2> <p>It's a good idea to have read the first part of this series where we create a deployment. If you haven't you need to first create a deployment like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl run kubernetes-first-app --image=gcr.io/google-samples/kubernetes-bootcamp:v1 --port=8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Now we should be good to go.</p> <p>Ok. I know you are probably all tired from all theory by now.</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/pvol1jg1836scxpca7ne.gif" alt=""></p> <p>I bet you are just itching to learn more hands on Kubernetes with <code>kubectl</code>.</p> <p>Well, the time for that has come ðŸ˜ƒ. We will do two things:</p> <ol><li><strong>Create a Service</strong> and learn how we can expose our app using said Service</li> <li><strong>Learn about Labeling</strong> and how we can improve our querying game by having appropriate labels on our artifacts.</li></ol> <p>Let's create a new service.</p> <p>We will get acquainted with the <code>expose</code> command.</p> <p>Let's check for existing pods,</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pods
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://thepracticaldev.s3.amazonaws.com/i/6v0mk886spo5st1vgs7b.png" alt=""></p> <p>Next let's see what services we have:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get services
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://thepracticaldev.s3.amazonaws.com/i/6zvg4sn25ot4ujaejp4w.png" alt=""></p> <p>Next lets create a Service like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl expose deployment/kubernetes-first-app --type=&quot;NodePort&quot; --port 8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As you can see above we are just targeting one of our deployments <code>kubernetes-first-app</code> and referring to it with <code>[type]/[deployment name]</code> and type being <code>deployment</code>.</p> <p>We expose it as service of type <code>NodePort</code> and finally, we choose to expose it at port <code>8080</code>.
<img src="https://thepracticaldev.s3.amazonaws.com/i/v7q6dgetxhl7dlridoj9.png" alt=""></p> <p>Now run <code>kubectl get services</code> again and see the results:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/ydyvfwcg5sggzqdvmczc.png" alt=""></p> <p>As you can see we now have two services in use, our basic <code>kubernetes</code> service and our newly created <code>kubernetes-first-app</code>.</p> <p>Next up we need to grab the port of our service and assign that to a variable:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>export NODE_PORT=$(kubectl get services/kubernetes-first-app -o go-template='{{(index .spec.ports 0).nodePort}}')
echo NODE_PORT=$NODE_PORT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>We now have a our port stored on environment variable <code>NODE_PORT</code> and we are ready to start communicating with our service like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl $(minikube ip):$NODE_PORT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Which leads to the following output:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/b0ej25pbre67izc3e3uj.png" alt=""></p> <h3 id="creating-and-applying-labels"><a href="#creating-and-applying-labels" aria-hidden="true" class="header-anchor">#</a> Creating and applying Labels</h3> <p>When we created our deployment and our Pod, it was automatically assigned with a label.</p> <p>By typing</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl describe deployment
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>we can see the name of said label.</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/5uw4u9afp6muxzg7h1wr.png" alt=""></p> <p>Next up we can query the pods by that same label</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pods -l run=kubernetes-first-app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Above we are using <code>-l</code> to query for a specific label and <code>kubernetes-bootcamp</code> as the name of the label. This gives us the following result:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/hiq56f5xyflhh3g82mbl.png" alt=""></p> <p>You can do a similar query to your services:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get services -l run=kubernetes-first-app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>That just shows that you can query on different levels, for specific Pods or Services that have Pods with that label.</p> <p>Next up we will look at how to change the label</p> <p>First let's get the name of the pod, like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>POD_NAME=kubernetes-first-app-669789f4f8-6glpx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Above I'm just assigning what my Pod is called to a variable <code>POD_NAME</code>. Check with a <code>kubectl getpods</code> what your Pod is called.</p> <p>Then we can add/apply the new label like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl label pod $POD_NAME app=v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://thepracticaldev.s3.amazonaws.com/i/lmyflbuurr07gg9gzw5f.png" alt=""></p> <p>Verify that the new label have been set, like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl describe pod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>or</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl describe pods $POD_NAME
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://thepracticaldev.s3.amazonaws.com/i/6dv4nbveyzliw820plkm.png" alt=""></p> <p>As you can see from the result our new label <code>app=v1</code> has been appended to existing labels.</p> <p>Now we can query like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get pods -l app=v1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>That's pretty much how labeling works, how to get available labels, apply them and use them in a query. Ensure to give them a descriptive name like an app version, a certain environment or a name like <em>frontend</em> or <em>backend</em>, something that makes sense to your situation.</p> <h3 id="clean-up"><a href="#clean-up" aria-hidden="true" class="header-anchor">#</a> Clean up</h3> <p>Ok, so we created a service. We should learn how to clean up after ourselves. Run the following command to remove our service:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl delete service -l run=kubernetes-bootcamp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Verify the service is no longer there with:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl get services
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>also, ensure our exposed IP and port can no longer be reached:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl $(minikube ip):$NODE_PORT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Just because the service is gone doesn't mean the app is gone. The app should still be reachable on:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>kubectl exec -ti $POD_NAME curl localhost:8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>So what did we learn? We learned a bit more on Pods and Nodes. Furthermore, we learned that we shouldn't speak directly to Pods but rather use a high-level abstraction such as Services. Services use labels as a way to define a domain language and apply those to different Pods.</p> <p>Ok, so we understand a bit more on Kubernetes and how different concepts relate. We mentioned something called <em>desired state</em> a number of times but we didn't go into detail on how to set such a state. That's our next part in this series where we will cover how to set the <em>desired state</em> and how Kubernetes maintains it, so stay tuned.</p> <p>Click <a href="https://softchris.github.io/pages/kubernetes-three.html" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to go to the next part on Scaling.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1077fdd6.js" defer></script><script src="/assets/js/7.1b275639.js" defer></script><script src="/assets/js/6.6ae5d1ce.js" defer></script><script src="/assets/js/55.af78a3a1.js" defer></script>
  </body>
</html>
